# opengl_bindings

Bindings for OpenGL, for Windows and Linux.

(Note to macOS users: I'm unable to test on macOS myself, but the steps for macOS will be similar to the Linux steps, probably with a few tweaks. However, note that [Apple has officially deprecated OpenGL](https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/OpenGL-MacProgGuide/opengl_intro/opengl_intro.html), so they may break things at some point in the future).

## Overview

OpenGL exports its interface in a slightly unusual way. Older OpenGL functions (e.g. from version 1.x; the exact set depends on the OS) are available via a C header file, gl.h. However, later functions are only available at runtime, via a call to `wglGetProcAddress` (Windows) or `glXGetProcAddress` (Linux). A description of all OpenGL declarations can be found in [a huge XML file, gl.xml](https://github.com/KhronosGroup/OpenGL-Registry/blob/master/xml/gl.xml).

Therefore, Muon's bindings for OpenGL consist of two parts.

The first part, `opengl_static_*.mu`, contains the older OpenGL declarations. These are based on gl.h, and are generated by [Muon's binding generator, ffigen](https://github.com/nickmqb/muon/blob/master/ffigen/README.md).

The second part, `opengl_core3.3_*.mu`, contains the remaining declarations. It declares wrapper functions, each with a strongly typed signature. Under the hood, each function gets the address of the corresponding GL function and invokes it. These declarations are based on gl.xml, and are generated by [opengl_generator](../opengl_generator), a tool that is also part of this repo.

As the name indicates, `opengl_core3.3_*.mu` contains declarations that are part of the OpenGL 3.3 core profile. To use a newer OpenGL version, you can make some tweaks to opengl_generator and generate your own declarations. See the [README](../opengl_generator/README.md) for more details.

## Using OpenGL: Windows (Visual Studio)

1. Include `opengl_static_windows.mu` and `opengl_core3.3_windows.mu` in your program (e.g. using args file)
1. Add the following line to `external.h`: `#include <GL/gl.h>`
1. Compile program with Muon
1. For the C compilation step, link against opengl32.lib. E.g.: `cl my_program.c /link kernel32.lib user32.lib opengl32.lib`

## Using OpenGL: Linux (gcc)

1. Include `opengl_static_linux.mu` and `opengl_core3.3_linux.mu` in your program (e.g. using args file)
1. Add the following lines to `external.h`:
	`#include <GL/gl.h>`
	`#include <GL/glx.h>`
	`#include <GL/glu.h>`
	`#include <GL/glext.h>`
	`#include <GL/glxext.h>`
1. Compile program with Muon
1. For the C compilation step, link against libGL and libGLU. E.g.: `gcc -o my_program my_program.c -lGL -lGLU`

## Updating the static bindings

The bindings are defined in `opengl_static_*.rules`. You can update them if needed:

1. Build [Muon's binding generator: ffigen](https://github.com/nickmqb/muon/blob/master/ffigen/README.md).
1. Make changes to `opengl_static_*.rules`.
1. On Windows: `ffigen --source external_windows.h --rules opengl_static_windows.rules --output opengl_static_windows.mu`
1. On Linux: `ffigen --source external_linux.h --rules opengl_static_linux.rules --output opengl_static_linux.mu`

## Updating the runtime bindings

See [opengl_generator/README.md](../opengl_generator/README.md).
